<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Estimateur de projet bÃ¢timent</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo">ğŸ—ï¸</span>
      <div>
        <h1>Estimateur de projet bÃ¢timent</h1>
        <p class="subtitle">CoÃ»t travaux, ventilation par lots, honoraires, OPEX & coÃ»t global â€” tout modifiable et sauvegardable</p>
      </div>
    </div>
    <div class="actions-row">
      <button id="btn-calc" class="btn primary" type="button">Calculer</button>
      <button id="btn-save" class="btn">Sauvegarder lâ€™Ã©tat</button>
      <button id="btn-load" class="btn">Charger lâ€™Ã©tat</button>
      <button id="btn-reset" class="btn danger">RÃ©initialiser tout</button>
      <div class="export-group">
        <button id="btn-export-json" class="btn">Exporter JSON</button>
        <button id="btn-export-csv" class="btn">Exporter CSV</button>
        <label for="import-json" class="btn">Importer JSON</label>
        <input type="file" id="import-json" accept="application/json" hidden />
      </div>
    </div>
  </header>

  <main class="layout">
    <!-- Colonne ParamÃ¨tres & RÃ©fÃ©rentiel -->
    <section class="col">
      <div class="card">
        <h2>ParamÃ¨tres du projet</h2>
        <div class="grid grid-2">
          <label>Typologie
            <select id="typologie" class="fld"></select>
          </label>

          <label>Surface (mÂ²)
            <input type="number" id="surface" class="fld" min="0" step="1" value="1000" />
          </label>

          <label>Indice gÃ©ographique (Ã—)
            <input type="number" id="indiceGeo" class="fld" min="0.5" step="0.01" value="1.00" />
          </label>

          <label>RÃ©glementation
            <select id="reglementation" class="fld"></select>
          </label>

          <label>Type constructif
            <select id="typeConstructif" class="fld"></select>
          </label>

          <label>Contrainte sol
            <select id="contrainteSol" class="fld"></select>
          </label>

          <label>Contrainte terrain
            <select id="contrainteTerrain" class="fld"></select>
          </label>

          <label>Chauffage
            <select id="chauffage" class="fld"></select>
          </label>

          <label>Ventilation / Traitement dâ€™air
            <select id="ventilation" class="fld"></select>
          </label>

          <label>Ajout personnalisÃ© (â‚¬/mÂ²)
            <input type="number" id="ajoutPerso" class="fld" step="1" value="0" />
          </label>
        </div>

        <details class="mt">
          <summary class="summary">âš™ï¸ ParamÃ¨tres dâ€™exploitation (OPEX actualisÃ©s)</summary>
          <div class="grid grid-3 mt-s">
            <label>Horizon (annÃ©es)
              <input type="number" id="opexHorizon" class="fld" min="1" step="1" value="30" />
            </label>
            <label>Ã‰nergie (â‚¬/mÂ²/an â€” base)
              <input type="number" id="opexEnergyBase" class="fld" step="0.1" />
            </label>
            <label>Maintenance (% du coÃ»t travaux / an)
              <input type="number" id="opexMaintPct" class="fld" step="0.001" />
            </label>
            <label>Inflation Ã©nergie (%/an)
              <input type="number" id="inflationEnergy" class="fld" step="0.1" />
            </label>
            <label>Inflation maintenance (%/an)
              <input type="number" id="inflationMaint" class="fld" step="0.1" />
            </label>
            <label>Taux dâ€™actualisation (%/an)
              <input type="number" id="discountRate" class="fld" step="0.1" />
            </label>
          </div>
          <p class="hint mt-s">ğŸ’¡ Les valeurs ci-dessus se prÃ©-remplissent selon le systÃ¨me de chauffage/ventilation, mais restent Ã©ditables.</p>
        </details>
      </div>

      <div class="card">
        <details open>
          <summary class="summary">ğŸ“š RÃ©fÃ©rentiel (Ã©ditable)</summary>
          <div id="ref-tabs" class="tabs mt-s">
            <button data-tab="t-typologies" class="tab active">Bases â‚¬/mÂ²</button>
            <button data-tab="t-surcouts" class="tab">SurcoÃ»ts (%)</button>
            <button data-tab="t-systems" class="tab">SystÃ¨mes (â‚¬/mÂ²)</button>
            <button data-tab="t-honos" class="tab">Honoraires (%)</button>
            <button data-tab="t-presets" class="tab">Presets lots</button>
          </div>

          <div id="t-typologies" class="tab-pane active"></div>
          <div id="t-surcouts" class="tab-pane"></div>
          <div id="t-systems" class="tab-pane"></div>
          <div id="t-honos" class="tab-pane"></div>
          <div id="t-presets" class="tab-pane"></div>

          <div class="actions-row mt">
            <button id="btn-save-ref" class="btn">Sauvegarder le rÃ©fÃ©rentiel</button>
            <button id="btn-reset-ref" class="btn">RÃ©initialiser le rÃ©fÃ©rentiel</button>
          </div>
        </details>
      </div>
    </section>

    <!-- Colonne Ventilation, Honoraires & RÃ©cap -->
    <section class="col">
      <div class="card">
        <div class="row-between">
          <h2>Ventilation par lots</h2>
          <div>
            <button id="btn-preset-lots" class="btn">Charger preset typologie</button>
            <button id="btn-add-lot" class="btn">Ajouter un lot</button>
          </div>
        </div>
        <div class="table-wrap">
          <table id="lots-table">
            <thead>
              <tr><th>Lot</th><th>Ratio (%)</th><th>Montant (â‚¬)</th><th></th></tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                <td class="right bold">Total ratios</td>
                <td>
                  <span id="lots-total" class="pill">0%</span>
                </td>
                <td class="right"><span id="lots-sum-amount">0</span> â‚¬</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
        <p class="hint">Le total doit Ãªtre de 100â€¯%. Lâ€™indicateur passe au <span class="pill ok">vert</span> quand câ€™est bon.</p>
      </div>

      <div class="card">
        <h2>Honoraires & Ã©tudes (sur coÃ»t travaux)</h2>
        <div class="table-wrap">
          <table id="honos-table">
            <thead>
              <tr><th>Intervenant</th><th>%</th><th>Montant (â‚¬)</th></tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                <td class="right bold">Total honoraires</td>
                <td></td>
                <td class="right"><span id="honos-total">0</span> â‚¬</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <div class="card">
        <h2>RÃ©capitulatif</h2>
        <div class="grid grid-3">
          <div class="stat">
            <div class="stat-label">Base â‚¬/mÂ² ajustÃ©e</div>
            <div class="stat-value"><span id="base-ajustee">0</span> â‚¬ / mÂ²</div>
            <div class="stat-sub">= base Ã— indice Ã— (1 + surcoÃ»ts %) + additions â‚¬/mÂ²</div>
          </div>
          <div class="stat">
            <div class="stat-label">CoÃ»t travaux</div>
            <div class="stat-value"><span id="cout-travaux">0</span> â‚¬</div>
            <div class="stat-sub"><span id="recap-details"></span></div>
          </div>
          <div class="stat">
            <div class="stat-label">Honoraires</div>
            <div class="stat-value"><span id="cout-honos">0</span> â‚¬</div>
            <div class="stat-sub">AppliquÃ©s en % du coÃ»t travaux</div>
          </div>
          <div class="stat">
            <div class="stat-label">OPEX actualisÃ©es</div>
            <div class="stat-value"><span id="cout-opex">0</span> â‚¬</div>
            <div class="stat-sub">Ã‰nergie + maintenance (VAN)</div>
          </div>
          <div class="stat highlight">
            <div class="stat-label">CoÃ»t global (CAPEX + OPEX)</div>
            <div class="stat-value"><span id="cout-global">0</span> â‚¬</div>
            <div class="stat-sub"><span id="cout-global-m2">0</span> â‚¬ / mÂ²</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>ğŸ’¾ Sauvegarde locale (LocalStorage) â€” donnÃ©es non envoyÃ©es.</span>
  </footer>

  <script src="app.js"></script>
</body>
</html>
